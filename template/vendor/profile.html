{% extends "vendor/base.html" %}
{% load static %}

{% block title %}Vendor Profile{% endblock %}

{% block content %}

<!-- Simple Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <h4 class="fw-bold mb-0">My Profile</h4>
    <a href="{% url 'vendor_dashboard' %}" class="btn btn-outline-secondary btn-sm">
        ‚Üê Back to Dashboard
    </a>
</div>

<!-- Messages -->
{% if messages %}
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endfor %}
{% endif %}

<!-- Profile View Mode -->
<div id="profile-view">
    <div class="card shadow-sm border-0">
        <div class="card-body p-4">
            <!-- Profile Header with Avatar -->
            <div class="d-flex align-items-center mb-4">
                <div class="avatar-circle bg-primary bg-opacity-10 me-3">
                    {% if vendor.business_logo %}
                        <img src="{{ vendor.business_logo.url }}" alt="Profile" class="rounded-circle w-100 h-100 object-fit-cover">
                    {% else %}
                        <span class="text-primary fw-bold fs-4">{{ vendor.fullname|first|upper }}</span>
                    {% endif %}
                </div>
                <div>
                    <h5 class="mb-1">{{ vendor.fullname }}</h5>
                    <p class="text-muted small mb-0">{{ vendor.email }}</p>
                </div>
            </div>

            <!-- Profile Details Grid -->
            <div class="row g-3">
                <div class="col-md-6">
                    <div class="info-item">
                        <small class="text-muted d-block mb-1">Full Name</small>
                        <span class="fw-medium">{{ vendor.fullname }}</span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="info-item">
                        <small class="text-muted d-block mb-1">Email Address</small>
                        <span class="fw-medium">{{ vendor.email }}</span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="info-item">
                        <small class="text-muted d-block mb-1">Mobile Number</small>
                        <span class="fw-medium">{{ vendor.mobile|default:"Not provided" }}</span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="info-item">
                        <small class="text-muted d-block mb-1">Role</small>
                        <span class="badge bg-light text-dark px-3 py-2">{{ vendor.role.name|title }}</span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="info-item">
                        <small class="text-muted d-block mb-1">Member Since</small>
                        <span class="fw-medium">{{ vendor.created_at|date:"M d, Y" }}</span>
                    </div>
                </div>
                {% if vendor.business_logo %}
                <div class="col-12">
                    <div class="info-item">
                        <small class="text-muted d-block mb-1">Business Logo</small>
                        <img src="{{ vendor.business_logo.url }}" alt="Business Logo" style="max-height: 60px; border-radius: 6px;">
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Edit Button -->
            <div class="mt-4 pt-3 border-top">
                <button class="btn btn-primary" onclick="showEditMode()">
                    <i class="bi bi-pencil me-2"></i>Edit Profile
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Profile Edit Mode (Hidden by default) -->
<div id="profile-edit" style="display: none;">
    <div class="card shadow-sm border-0">
        <div class="card-body p-4">
            <h5 class="mb-3">Edit Profile</h5>
            
            <form method="POST" enctype="multipart/form-data" id="profile-form">
                {% csrf_token %}
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label fw-medium">Full Name <span class="text-danger">*</span></label>
                        <input type="text" name="fullname" class="form-control" value="{{ vendor.fullname }}" required>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label fw-medium">Email <span class="text-danger">*</span></label>
                        <input type="email" name="email" class="form-control" value="{{ vendor.email }}" required>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label fw-medium">Mobile Number</label>
                        <input type="text" name="mobile" class="form-control" value="{{ vendor.mobile|default_if_none:'' }}">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label fw-medium">Role</label>
                        <input type="text" class="form-control bg-light" value="{{ vendor.role.name }}" disabled>
                    </div>

                    <div class="col-12 mb-3">
                        <label class="form-label fw-medium">Business Logo</label>
                        <input type="file" name="business_logo" class="form-control" accept="image/*">
                        {% if vendor.business_logo %}
                        <div class="mt-2">
                            <img src="{{ vendor.business_logo.url }}" alt="Current Logo" style="max-height: 50px; border-radius: 4px;">
                            <small class="text-muted ms-2">Current logo</small>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <div class="d-flex gap-2 mt-3">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check2 me-2"></i>Save Changes
                    </button>
                    <button type="button" class="btn btn-outline-secondary" onclick="hideEditMode()">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<style>
    .avatar-circle {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
    }
    
    .object-fit-cover {
        object-fit: cover;
    }
    
    .card {
        border-radius: 12px;
    }
    
    .info-item {
        padding: 10px;
        background: #f8f9fa;
        border-radius: 8px;
    }
    
    .border-top {
        border-color: #e9ecef !important;
    }
    
    .badge {
        font-weight: 500;
        padding: 0.5rem 1rem;
    }
    
    .form-control {
        border-radius: 8px;
        border: 1px solid #e0e0e0;
        padding: 0.6rem 1rem;
    }
    
    .form-control:focus {
        box-shadow: none;
        border-color: #0d6efd;
    }
    
    .btn {
        padding: 0.6rem 1.5rem;
        border-radius: 8px;
    }
    
    @media (max-width: 768px) {
        .avatar-circle {
            width: 50px;
            height: 50px;
        }
    }
</style>

<script>
function showEditMode() {
    document.getElementById('profile-view').style.display = 'none';
    document.getElementById('profile-edit').style.display = 'block';
}

function hideEditMode() {
    document.getElementById('profile-view').style.display = 'block';
    document.getElementById('profile-edit').style.display = 'none';
}

// Form validation
document.getElementById('profile-form')?.addEventListener('submit', function(e) {
    let fullname = document.querySelector('[name="fullname"]').value.trim();
    let email = document.querySelector('[name="email"]').value.trim();
    
    if (!fullname || !email) {
        e.preventDefault();
        alert('Please fill in all required fields');
    }
});
</script>
{% endblock %}